<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  
  <meta name="description" content="记录生活和代码，鼓励阅读与创作">
  

  <!--Author-->
  
  <meta name="author" content="jean">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="webpack"/>
  
  <!--Open Graph Description-->
  
      <meta property="og:description" content="记录生活和代码，鼓励阅读与创作" />
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="jean"/>
  <!--Type page-->
  
      <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title -->
  
  <title>webpack - jean</title>


  <link rel="shortcut icon" href="/images/favicon32.jpg">

  <!-- Custom CSS/Sass -->
  
<link rel="stylesheet" href="/css/style.css">


  <!----------------------------
  https://github.com/GallenHu/hexo-theme-Daily

 _____            _   _
|  __ \          (_) | |
| |  | |   __ _   _  | |  _   _
| |  | |  / _` | | | | | | | | |
| |__| | | (_| | | | | | | |_| |
|_____/   \__,_| |_| |_|  \__, |
                          __/ |
                         |___/

    --------------------------->

<meta name="generator" content="Hexo 4.2.0"></head>


<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="/images/logo.svg" alt="jean" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  Home
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  Archive
                
              </a>
            </li>
          
            <li>
              <a href="/1993/07/27/about">
                
                  About
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            webpack
            
          </h1>
          <p class="posted-on">
          2020-03-09
          </p>
          <div class="tags-links">
            
              
            
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content has_line_number">
          <h2 id="webpack是什么？"><a href="#webpack是什么？" class="headerlink" title="webpack是什么？"></a>webpack是什么？</h2><p>webpack是一个现代javascript 应用程序的<strong>静态模块打包器</strong>，当webpack处理应用程序时，会递归构建一个依赖关系图，其中包含应用程序需要的每个模块，然后将这些模块打包成一个或多个bundle。</p>
<h2 id="webpack核心概念"><a href="#webpack核心概念" class="headerlink" title="webpack核心概念"></a>webpack核心概念</h2><ul>
<li>entry：入口</li>
<li>output：出口</li>
<li>loader：模块转换器，用于吧模块原内容按照需求转换成新内容</li>
<li>插件（plugins）：扩展插件，在webpack构建流程中的特定时机注入扩展逻辑来改变构建结果或做你想要做的事</li>
</ul>
<h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><ul>
<li>新建一个文件夹，如：webpack-first(可由自己定不固定)</li>
<li>使用npm init - y进行初始化项目（也可以使用yarn） -y 的含义：yes的意思，在init的时候省去了敲回车的步骤，生成的默认的package.json</li>
<li>要使用webpack，那么必须安装 webpack webpack-cli:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli -D</span><br></pre></td></tr></table></figure>
鉴于前段发展迅速，本文基于webpack的版本号：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack@4.42.0</span><br></pre></td></tr></table></figure></li>
<li>从webpack V4.0.0 开始，webpack是开箱即用的，在不引入任何配置资源的情况下就可以使用</li>
<li>新建src/index.js 文件，我们在文件中随便写点什么： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;index.js</span><br><span class="line">class Animal&#123;</span><br><span class="line">    constructor(name)&#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">    &#125;</span><br><span class="line">    getName()&#123;</span><br><span class="line">        return this.name; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">const dog &#x3D; new Animal(&#39;dog&#39;);</span><br></pre></td></tr></table></figure></li>
<li>使用 npx webpack –mode=development 进行构建，默认是production模式，我们为了更清楚的查看打包后的代码，使用development模式。</li>
<li>可以看到项目下多了个dist目录，里面有一个打包出来的main.js.</li>
<li>webpack 有默认的配置，如默认的入口文件是./src,默认打包到dist/main.js。更多的默认配置可以查看mode_modules/webpack/lib/webpackOptionsDefaulter.js。</li>
<li>查看dist/mian.js文件可以看到src/index.js并没有转义为较低版本的代码，这不是我们想要的<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;***&#x2F; &quot;.&#x2F;src&#x2F;index.js&quot;:</span><br><span class="line">&#x2F;*!**********************!*\</span><br><span class="line">  !*** .&#x2F;src&#x2F;index.js ***!</span><br><span class="line">  \**********************&#x2F;</span><br><span class="line">&#x2F;*! no static exports found *&#x2F;</span><br><span class="line">&#x2F;***&#x2F; (function(module, exports) &#123;</span><br><span class="line"></span><br><span class="line">eval(&quot;class Animal&#123;\r\n    constructor(name)&#123;\r\n        this.name &#x3D; name;\r\n    &#125;\r\n    getName()&#123;\r\n        return this.name; \r\n    &#125;\r\n&#125;\r\nconst dog &#x3D; new Animal(&#39;dog&#39;);\n\n&#x2F;&#x2F;# sourceURL&#x3D;webpack:&#x2F;&#x2F;&#x2F;.&#x2F;src&#x2F;index.js?&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;***&#x2F; &#125;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="将JS转义为低版本"><a href="#将JS转义为低版本" class="headerlink" title="将JS转义为低版本"></a>将JS转义为低版本</h2><ul>
<li>之前我们说了webpack的四个核心概念，其中之一就是loader，<strong>loader用于对源码进行转换</strong>，这正是我们现在所需要的</li>
<li>将JS代码向低版本转换，我们需要使用babel-loader。</li>
</ul>
<h3 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h3><ul>
<li>首先安装一下babel-loader<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i babel-loader -D</span><br></pre></td></tr></table></figure></li>
<li>此外我们还需要配置babel，为此我们安装以下依赖：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i @babel&#x2F;core @babel&#x2F;preset-env @babel&#x2F;plugin-transform-runtime -D</span><br><span class="line">npm i @babel&#x2F;runtime @babel&#x2F;runtime-corejs3</span><br></pre></td></tr></table></figure></li>
<li>对babel7配置不熟悉的小伙伴，可以阅读一下这边文章：<a href="https://segmentfault.com/a/1190000021167230?utm_source=tag-newest" target="_blank" rel="noopener">不容错过的Babel7知识</a></li>
<li>新建webpack.config.js,如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.jsx?$&#x2F;,</span><br><span class="line">                use: [&#39;babel-loader&#39;],</span><br><span class="line">                exclude: &#x2F;node_modules&#x2F; &#x2F;&#x2F;排除 node_modules 目录</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
建议给 loader 指定 include 或是 exclude，指定其中一个即可，因为 node_modules 目录通常不需要我们去编译，排除后，有效提升编译效率。</li>
</ul>
<p>这里，我们可以在 .babelrc 中编写 babel 的配置，也可以在 webpack.config.js 中进行配置。</p>
<h3 id="创建一个-babelrc"><a href="#创建一个-babelrc" class="headerlink" title="创建一个 .babelrc"></a>创建一个 .babelrc</h3><p>配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [&quot;@babel&#x2F;preset-env&quot;],</span><br><span class="line">    &quot;plugins&quot;: [</span><br><span class="line">        [</span><br><span class="line">            &quot;@babel&#x2F;plugin-transform-runtime&quot;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;corejs&quot;: 3</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，我们重新执行  npx webpack –mode=development，查看 dist/main.js，会发现已经被编译成了低版本的JS代码。</p>
<h3 id="在webpack中配置-babel"><a href="#在webpack中配置-babel" class="headerlink" title="在webpack中配置 babel"></a>在webpack中配置 babel</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F; mode: &#39;development&#39;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.jsx?$&#x2F;,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: &#39;babel-loader&#39;,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [&quot;@babel&#x2F;preset-env&quot;],</span><br><span class="line">                        plugins: [</span><br><span class="line">                            [</span><br><span class="line">                                &quot;@babel&#x2F;plugin-transform-runtime&quot;,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    &quot;corejs&quot;: 3</span><br><span class="line">                                &#125;</span><br><span class="line">                            ]</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                exclude: &#x2F;node_modules&#x2F;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有几点需要说明：</p>
<ul>
<li>loader 需要配置在 module.rules 中，rules 是一个数组。</li>
<li>loader 的格式为:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: &#x2F;\.jsx?$&#x2F;,&#x2F;&#x2F;匹配规则</span><br><span class="line">    use: &#39;babel-loader&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
或者也可以像下面这样:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;适用于只有一个 loader 的情况</span><br><span class="line">&#123;</span><br><span class="line">    test: &#x2F;\.jsx?$&#x2F;,</span><br><span class="line">    loader: &#39;babel-loader&#39;,</span><br><span class="line">    options: &#123;</span><br><span class="line">        &#x2F;&#x2F;...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
test 字段是匹配规则，针对符合规则的文件进行处理。</li>
</ul>
<p>use 字段有几种写法</p>
<ul>
<li>可以是一个字符串，例如上面的 use: ‘babel-loader’</li>
<li>use 字段可以是一个数组，例如处理CSS文件时，use: [‘style-loader’, ‘css-loader’]</li>
<li>use 数组的每一项既可以是字符串也可以是一个对象，当我们需要在webpack 的配置文件中对 loader 进行配置，就需要将其编写为一个对象，并且在此对象的 options 字段中进行配置，如：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: &#x2F;\.jsx?$&#x2F;,</span><br><span class="line">        use: &#123;</span><br><span class="line">            loader: &#39;babel-loader&#39;,</span><br><span class="line">            options: &#123;</span><br><span class="line">                presets: [&quot;@babel&#x2F;preset-env&quot;]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        exclude: &#x2F;node_modules&#x2F;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>上面我们说了如何将JS的代码编译成向下兼容的代码，当然你可以还需要一些其它的 babel 的插件和预设，例如 @babel/preset-react，@babel/plugin-proposal-optional-chaining 等，不过，babel 的配置并非本文的重点，我们继续往下。</p>
<p>不要说细心的小伙伴了，即使是粗心的小伙伴肯定也发现了，我们在使用 webpack 进行打包的时候，一直运行的都是 npx webpack –mode=development 是否可以将 mode 配置在 webpack.config.js 中呢？显然是可以的。</p>
<h2 id="5-MODE"><a href="#5-MODE" class="headerlink" title="5.MODE"></a>5.MODE</h2><p>将 mode 增加到 webpack.config.js 中:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;....</span><br><span class="line">    mode: &quot;development&quot;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        &#x2F;&#x2F;...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mode 配置项，告知 webpack 使用相应模式的内置优化。</p>
<p>mode 配置项，支持以下两个配置:</p>
<ul>
<li><p>development：将 process.env.NODE_ENV 的值设置为 development，启用 NamedChunksPlugin 和 NamedModulesPlugin</p>
</li>
<li><p>production：将 process.env.NODE_ENV 的值设置为 production，启用 FlagDependencyUsagePlugin, FlagIncludedChunksPlugin, ModuleConcatenationPlugin, NoEmitOnErrorsPlugin, OccurrenceOrderPlugin, SideEffectsFlagPlugin 和 UglifyJsPlugin</p>
</li>
</ul>
<p>现在，我们之间使用 npx webpack 进行编译即可。</p>
<h2 id="6-在浏览器中查看页面"><a href="#6-在浏览器中查看页面" class="headerlink" title="6.在浏览器中查看页面"></a>6.在浏览器中查看页面</h2><p>搞了这么久，还不能在浏览器中查看页面，这显然不能忍！</p>
<p>查看页面，难免就需要 html 文件，有小伙伴可能知道，有时我们会指定打包文件中带有 hash，那么每次生成的 js 文件名会有所不同，总不能让我们每次都人工去修改 html，这样不是显得我们很蠢嘛~</p>
<p>我们可以使用 html-webpack-plugin 插件来帮助我们完成这些事情。</p>
<p>首先，安装一下插件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p>新建 public 目录，并在其中新建一个 index.html 文件( 文件内容使用 html:5 快捷生成即可)</p>
<p>修改 webpack.config.js 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;首先引入插件</span><br><span class="line">const HtmlWebpackPlugin &#x3D; require(&#39;html-webpack-plugin&#39;);</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    plugins: [</span><br><span class="line">        &#x2F;&#x2F;数组 放着所有的webpack插件</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &#39;.&#x2F;public&#x2F;index.html&#39;,</span><br><span class="line">            filename: &#39;index.html&#39;, &#x2F;&#x2F;打包后的文件名</span><br><span class="line">            minify: &#123;</span><br><span class="line">                removeAttributeQuotes: false, &#x2F;&#x2F;是否删除属性的双引号</span><br><span class="line">                collapseWhitespace: false, &#x2F;&#x2F;是否折叠空白</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x2F;&#x2F; hash: true &#x2F;&#x2F;是否加上hash，默认是 false</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时执行 npx webpack，可以看到 dist 目录下新增了 index.html 文件，并且其中自动插入了 script 脚本，引入的是我们打包之后的 js 文件。</p>
<p>这里要多说一点点东西，HtmlWebpackPlugin 还为我们提供了一个 config 的配置，这个配置可以说是非常有用了。</p>
<h3 id="html-webpack-plugin-的-config-的妙用"><a href="#html-webpack-plugin-的-config-的妙用" class="headerlink" title="html-webpack-plugin 的 config 的妙用"></a>html-webpack-plugin 的 config 的妙用</h3><p>有时候，我们的脚手架不仅仅给自己使用，也许还提供给其它业务使用，html 文件的可配置性可能很重要，比如：你公司有专门的部门提供M页的公共头部/公共尾部，埋点jssdk以及分享的jssdk等等，但是不是每个业务都需要这些内容。</p>
<p>一个功能可能对应多个 js 或者是 css 文件，如果每次都是业务自行修改 public/index.html 文件，也挺麻烦的。首先他们得搞清楚每个功能需要引入的文件，然后才能对 index.html 进行修改。</p>
<p>此时我们可以增加一个配置文件，业务通过设置 true 或 false 来选出自己需要的功能，我们再根据配置文件的内容，为每个业务生成相应的 html 文件，岂不是美美的。</p>
<p>Let’s Go!</p>
<p>首先，我们在 public 目录下新增一个 config.js ( 文件名你喜欢叫什么就叫什么 )，将其内容设置为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;public&#x2F;config.js 除了以下的配置之外，这里面还可以有许多其他配置，例如,pulicPath 的路径等等</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    dev: &#123;</span><br><span class="line">        template: &#123;</span><br><span class="line">            title: &#39;你好&#39;,</span><br><span class="line">            header: false,</span><br><span class="line">            footer: false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    build: &#123;</span><br><span class="line">        template: &#123;</span><br><span class="line">            title: &#39;你好才怪&#39;,</span><br><span class="line">            header: true,</span><br><span class="line">            footer: false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，我们修改下我们的 webpack.config.js:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">const HtmlWebpackPlugin &#x3D; require(&#39;html-webpack-plugin&#39;);</span><br><span class="line">const isDev &#x3D; process.env.NODE_ENV &#x3D;&#x3D;&#x3D; &#39;development&#39;;</span><br><span class="line">const config &#x3D; require(&#39;.&#x2F;public&#x2F;config&#39;)[isDev ? &#39;dev&#39; : &#39;build&#39;];</span><br><span class="line"></span><br><span class="line">modue.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    mode: isDev ? &#39;development&#39; : &#39;production&#39;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &#39;.&#x2F;public&#x2F;index.html&#39;,</span><br><span class="line">            filename: &#39;index.html&#39;, &#x2F;&#x2F;打包后的文件名</span><br><span class="line">            config: config.template</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相应的，我们需要修改下我们的 public/index.html 文件(嵌入的js和css并不存在，仅作为示意)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;% if(htmlWebpackPlugin.options.config.header) &#123; %&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot; href&#x3D;&quot;&#x2F;&#x2F;common&#x2F;css&#x2F;header.css&quot;&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">    &lt;title&gt;&lt;%&#x3D; (htmlWebpackPlugin.options.config.title) %&gt;&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;&#x2F;body&gt; </span><br><span class="line">&lt;% if(htmlWebpackPlugin.options.config.header) &#123; %&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;&#x2F;&#x2F;common&#x2F;header.min.js&quot; type&#x3D;&quot;text&#x2F;javascript&quot;&gt;&lt;&#x2F;script&gt; </span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>process.env 中默认并没有 NODE_ENV，这里配置下我们的 package.json 的 scripts.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">        &quot;dev&quot;: &quot;NODE_ENV&#x3D;development webpack&quot;,</span><br><span class="line">        &quot;build&quot;: &quot;NODE_ENV&#x3D;production webpack&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果以上代码报错修改为如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">   &quot;dev&quot;: &quot;set NODE_ENV&#x3D;development &amp;&amp; webpack&quot;,</span><br><span class="line">   &quot;build&quot;: &quot;set NODE_ENV&#x3D;production &amp;&amp; webpack&quot;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>然后我们运行 npm run dev 和 运行 npm run build ，对比下 dist/index.html ，可以看到 npm run build，生成的 index.html 文件中引入了对应的 css 和 js。并且对应的 title 内容也不一样。<br><strong>如果出现没有变化使用JSON.stringify查看内容是否有多余空格；有的话在webpack.config.js文件中使用trim函数去除多余空格将process.env.NODE_ENV.trim()</strong></p>
<p>你说这里是不是非得是用 NODE_ENV 去判断？当然不是咯，你写 aaa=1 ，aaa=2 都行（当然啦，webpack.config.js 和 scripts 都需要进行相应修改），但是可能会被后面接手的人打死。</p>
<h3 id="如何在浏览器中实时展示效果"><a href="#如何在浏览器中实时展示效果" class="headerlink" title="如何在浏览器中实时展示效果"></a>如何在浏览器中实时展示效果</h3><p>说了这么多，到现在还没能在浏览器中实时查看效果，是不是已经有点捉急了，先看一下如何实时查看效果吧，不然都不知道自己配得对不对。</p>
<p>话不多说，先装依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server -D</span><br></pre></td></tr></table></figure>
<p>修改下咱们的 package.json 文件的 scripts：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;dev&quot;: &quot;NODE_ENV&#x3D;development webpack-dev-server&quot;,</span><br><span class="line">    &quot;build&quot;: &quot;NODE_ENV&#x3D;production webpack&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>在控制台执行 npm run dev，启动正常，页面上啥也没有，修改下我们的JS代码，往页面中增加点内容，正常刷新(也就是说不需要进行任何配置就可以使用了)。</p>
<p>Excuse me。怪我平时不认真咯，每次都乖乖的配个 contentBase，原来根本不需要配，带着疑问，我又去搜寻了一番。</p>
<p>原来在配置了 html-webpack-plugin 的情况下， contentBase 不会起任何作用，也就是说我以前都是白配了，这是一个悲伤的故事。</p>
<p>不过呢，我们还是可以在 webpack.config.js 中进行 webpack-dev-server 的其它配置，例如指定端口号，设置浏览器控制台消息，是否压缩等等:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        port: &#39;3000&#39;, &#x2F;&#x2F;默认是8080</span><br><span class="line">        quiet: false, &#x2F;&#x2F;默认不启用</span><br><span class="line">        inline: true, &#x2F;&#x2F;默认开启 inline 模式，如果设置为false,开启 iframe 模式</span><br><span class="line">        stats: &quot;errors-only&quot;, &#x2F;&#x2F;终端仅打印 error</span><br><span class="line">        overlay: false, &#x2F;&#x2F;默认不启用</span><br><span class="line">        clientLogLevel: &quot;silent&quot;, &#x2F;&#x2F;日志等级</span><br><span class="line">        compress: true &#x2F;&#x2F;是否启用 gzip 压缩</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>启用 quiet 后，除了初始启动信息之外的任何内容都不会被打印到控制台。这也意味着来自 webpack 的错误或警告在控制台不可见 ———— 我是不会开启这个的，看不到错误日志，还搞个锤子</li>
<li>stats: “errors-only” ， 终端中仅打印出 error，注意当启用了 quiet 或者是 noInfo 时，此属性不起作用。————— 这个属性个人觉得很有用，尤其是我们启用了 eslint 或者使用 TS进行开发的时候，太多的编译信息在终端中，会干扰到我们。</li>
<li>启用 overlay 后，当编译出错时，会在浏览器窗口全屏输出错误，默认是关闭的。</li>
<li>clientLogLevel: 当使用内联模式时，在浏览器的控制台将显示消息，如：在重新加载之前，在一个错误之前，或者模块热替换启用时。如果你不喜欢看这些信息，可以将其设置为 silent (none 即将被移除)。</li>
</ul>
<p>本篇文章不是为了细说 webpack-dev-server 的配置，所以这里就不多说了。关于 webpack-dev-server 更多的配置可以查看官方文档。</p>
<p>细心的小伙伴可能发现了一个小问题，我们在src/index.js中增加一句 console.log(‘aaa’)：<br>然后通过 npm run dev 查看效果，会发现：<br><img src="/images/webpack/html-line.jpg" alt="Image text"><br><img src="/images/webpack/source.jpg" alt="Image text"><br>这显然不是我们源码中对应的行号，点进去的话，会发现代码是被编译后的，我当前的代码非常简单，还能看出来，项目代码复杂后，“亲妈”看编译后都费劲，这不利于我们开发调试，不是我们想要的，我们肯定还是希望能够直接对应到源码的。</p>
<h2 id="7-devtool"><a href="#7-devtool" class="headerlink" title="7.devtool"></a>7.devtool</h2><p>devtool 中的一些设置，可以帮助我们将编译后的代码映射回原始源代码。不同的值会明显影响到构建和重新构建的速度。</p>
<p>对我而言，能够定位到源码的行即可，因此，综合构建速度，在开发模式下，我设置的 devtool 的值是 cheap-module-eval-source-map。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    devtool: &#39;cheap-module-eval-source-map&#39; &#x2F;&#x2F;开发环境下使用</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生产环境可以使用 none 或者是 source-map，使用 source-map 最终会单独打包出一个 .map 文件，我们可以根据报错信息和此 map 文件，进行错误解析，定位到源代码。</p>
<p>source-map 和 hidden-source-map 都会打包生成单独的 .map 文件，区别在于，source-map 会在打包出的js文件中增加一个引用注释，以便开发工具知道在哪里可以找到它。hidden-source-map 则不会在打包的js中增加引用注释。</p>
<p>但是我们一般不会直接将 .map 文件部署到CDN，因为会直接映射到源码，更希望将.map 文件传到错误解析系统，然后根据上报的错误信息，直接解析到出错的源码位置。</p>
<p>不过报错信息中只有行号，而没有列号。如果有行列号，那么可以通过sourcemap 来解析出错位置。只有行号，根本无法解析，不知道大家的生产环境是如何做的？怎么上报错误信息至错误解析系统进行解析。如有好的方案，请赐教。</p>
<p>还可以设置其他的devtool值，你可以使用不同的值，构建对比差异。</p>
<p>现在我们已经说了 html、js 了，并且也可以在浏览器中实时看到效果了，现在就不得不说页面开发三巨头之一的 css 。</p>
<h2 id="8-如何处理样式文件呢"><a href="#8-如何处理样式文件呢" class="headerlink" title="8.如何处理样式文件呢"></a>8.如何处理样式文件呢</h2><p>webpack 不能直接处理 css，需要借助 loader。如果是 .css，我们需要的 loader 通常有： style-loader、css-loader，考虑到兼容性问题，还需要 postcss-loader，而如果是 less 或者是 sass 的话，还需要 less-loader 和 sass-loader，这里配置一下 less 和 css 文件(sass 的话，使用 sass-loader即可):</p>
<p>先安装一下需要使用的依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install style-loader less-loader css-loader postcss-loader autoprefixer less -D</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.(le|c)ss$&#x2F;,</span><br><span class="line">                use: [&#39;style-loader&#39;, &#39;css-loader&#39;, &#123;</span><br><span class="line">                    loader: &#39;postcss-loader&#39;,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        plugins: function () &#123;</span><br><span class="line">                            return [</span><br><span class="line">                                require(&#39;autoprefixer&#39;)(&#123;</span><br><span class="line">                                    &quot;overrideBrowserslist&quot;: [</span><br><span class="line">                                        &quot;&gt;0.25%&quot;,</span><br><span class="line">                                        &quot;not dead&quot;</span><br><span class="line">                                    ]</span><br><span class="line">                                &#125;)</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, &#39;less-loader&#39;],</span><br><span class="line">                exclude: &#x2F;node_modules&#x2F;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试一下，新建一个 less 文件，src/index.less:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;src&#x2F;index.less</span><br><span class="line">@color: red;</span><br><span class="line">body&#123;</span><br><span class="line">    background: @color;</span><br><span class="line">    transition: all 2s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再在入口文件中引入此 less:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;src&#x2F;index.js</span><br><span class="line">import &#39;.&#x2F;index.less&#39;;</span><br></pre></td></tr></table></figure>
<p>我们修改了配置文件，重新启动一下服务: npm run dev。可以看到页面的背景色变成了红色。</p>
<p>OK，我们简单说一下上面的配置：</p>
<p>style-loader 动态创建 style 标签，将 css 插入到 head 中.<br>css-loader 负责处理 @import 等语句。<br>postcss-loader 和 autoprefixer，自动生成浏览器兼容性前缀 —— 2020了，应该没人去自己徒手去写浏览器前缀了吧<br>less-loader 负责处理编译 .less 文件,将其转为 css<br>这里，我们之间在 webpack.config.js 写了 autoprefixer 需要兼容的浏览器，仅是为了方便展示。推荐大家在根目录下创建 .browserslistrc，将对应的规则写在此文件中，除了 autoprefixer 使用外，@babel/preset-env、stylelint、eslint-plugin-conmpat 等都可以共用。</p>
<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><p>loader 的执行顺序是从右向左执行的，也就是后面的 loader 先执行，上面 loader 的执行顺序为: less-loader —&gt; postcss-loader —&gt; css-loader —&gt; style-loader</p>
<p>当然，loader 其实还有一个参数，可以修改优先级，enforce 参数，其值可以为: pre(优先执行) 或 post (滞后执行)。</p>
<p>现在，我们已经可以处理 .less 文件啦，.css 文件只需要修改匹配规则，删除 less-loader 即可。</p>
<p>现在的一切看起来都很完美，但是假设我们的文件中使用了本地的图片，例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">body&#123;</span><br><span class="line">    backgroud: url(&#39;..&#x2F;images&#x2F;thor.png&#39;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你就会发现，报错啦啦啦，那么我们要怎么处理图片或是本地的一些其它资源文件呢。不用想，肯定又需要 loader 出马了。</p>
<h2 id="9-图片-字体文件处理"><a href="#9-图片-字体文件处理" class="headerlink" title="9.图片/字体文件处理"></a>9.图片/字体文件处理</h2><p>我们可以使用 url-loader 或者 file-loader 来处理本地的资源文件。url-loader 和 file-loader 的功能类似，但是 url-loader 可以指定在文件大小小于指定的限制时，返回 DataURL，因此，个人会优先选择使用 url-loader。</p>
<p>首先安装依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install url-loader -D</span><br></pre></td></tr></table></figure>
<p>安装 url-loader 的时候，控制台会提示你，还需要安装下 file-loader，听人家的话安装下就行(新版 npm 不会自动安装 peerDependencies)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install file-loader -D</span><br></pre></td></tr></table></figure>
<p>在 webpack.config.js 中进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    modules: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.(png|jpg|gif|jpeg|webp|svg|eot|ttf|woff|woff2)$&#x2F;,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: &#39;url-loader&#39;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: 10240, &#x2F;&#x2F;10K</span><br><span class="line">                            esModule: false </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                exclude: &#x2F;node_modules&#x2F;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处设置 limit 的值大小为 10240，即资源大小小于 10K 时，将资源转换为 base64，超过 10K，将图片拷贝到 dist 目录。esModule 设置为 false，否则，&lt;img src={require(‘XXX.jpg’)} /&gt; 会出现 &lt;img src=[Module Object] /&gt;</p>
<p>将资源转换为 base64 可以减少网络请求次数，但是 base64 数据较大，如果太多的资源是 base64，会导致加载变慢，因此设置 limit 值时，需要二者兼顾。</p>
<p>默认情况下，生成的文件的文件名就是文件内容的 MD5 哈希值并会保留所引用资源的原始扩展名，例如我上面的图片(thor.jpeg)对应的文件名如下：</p>
<p>当然，你也可以通过 options 参数进行修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;....</span><br><span class="line">use: [</span><br><span class="line">    &#123;</span><br><span class="line">        loader: &#39;url-loader&#39;,</span><br><span class="line">        options: &#123;</span><br><span class="line">            limit: 10240, &#x2F;&#x2F;10K</span><br><span class="line">            esModule: false,</span><br><span class="line">            name: &#39;[name]_[hash:6].[ext]&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>重新编译，在浏览器中审查元素，可以看到图片名变成了: thor_a5f7c0.jpeg。</p>
<p>当本地资源较多时，我们有时会希望它们能打包在一个文件夹下，这也很简单，我们只需要在 url-loader 的 options 中指定 outpath，如: outputPath: ‘assets’，构建出的目录如在dist下的assets下<br>更多的 url-loader 配置可以查看官方文档</p>
<p>到了这里，有点岁月静好的感觉了。<br><img src="/images/webpack/years-quiet.jpg" alt="Image text"><br>不过还没完，如果你在 public/index.html 文件中，使用本地的图片，例如，我们修改一下 public/index.html：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;&quot;.&#x2F;a.jpg&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>重启本地服务，虽然，控制台不会报错，但是你会发现，浏览器中根本加载不出这张图片，Why？因为构建之后，通过相对路径压根找不着这张图片呀。</p>
<p>How？怎么解决呢？</p>
<h2 id="10-处理-html-中的本地图片"><a href="#10-处理-html-中的本地图片" class="headerlink" title="10.处理 html 中的本地图片"></a>10.处理 html 中的本地图片</h2><p>安装 html-withimg-loader 来解决咯。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-withimg-loader -D</span><br></pre></td></tr></table></figure>
<p>修改 webpack.config.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;.html$&#x2F;,</span><br><span class="line">                use: &#39;html-withimg-loader&#39;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在我们的 html 中引入一张文件测试一下（图片地址自己写咯，这里只是示意）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src&#x3D;&quot;.&#x2F;years-quiet.jpg&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>重启本地服务，图片并没能加载，审查元素的话，会发现图片的地址显示的是 {“default”:”assets/thor_a5f7c0.jpeg”}。</p>
<p>我当前 file-loader 的版本是 5.0.2，5版本之后，需要增加 esModule 属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    modules: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: &#x2F;\.(png|jpg|gif|jpeg|webp|svg|eot|ttf|woff|woff2)$&#x2F;,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: &#39;url-loader&#39;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: 10240, &#x2F;&#x2F;10K</span><br><span class="line">                            esModule: false</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再重启本地服务，就搞定啦。</p>
<p>话说使用 html-withimg-loader 处理图片之后，html 中就不能使用 vm, ejs 的模板了，如果想继续在 html 中使用 &lt;% if(htmlWebpackPlugin.options.config.header) { %&gt; 这样的语法，但是呢，又希望能使用本地图片，可不可以？鱼和熊掌都想要，虽然很多时候，能吃个鱼就不错了，但是这里是可以的哦，<strong>删除html的loader</strong>，像下面这样编写图片的地址就可以啦。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.html --&gt;</span><br><span class="line">&lt;img src&#x3D;&quot;&lt;%&#x3D; require(&#39;.&#x2F;thor.jpeg&#39;) %&gt;&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>图片加载OK啦，并且 &lt;% %&gt; 语法也可以正常使用，吼吼吼<del>~</del></p>
<p>虽然，webpack 的默认配置很好用，但是有的时候，我们会有一些其它需要啦，例如，我们不止一个入口文件，这时候，该怎么办呢？</p>
<h2 id="11-入口配置"><a href="#11-入口配置" class="headerlink" title="11.入口配置"></a>11.入口配置</h2><p>入口的字段为: entry</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    entry: &#39;.&#x2F;src&#x2F;index.js&#39; &#x2F;&#x2F;webpack的默认配置</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>entry 的值可以是一个字符串，一个数组或是一个对象。</p>
<p>字符串的情况无需多说，就是以对应的文件为入口。</p>
<p>为数组时，表示有“多个主入口”，想要多个依赖文件一起注入时，会这样配置。例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">entry: [</span><br><span class="line">    &#39;.&#x2F;src&#x2F;polyfills.js&#39;,</span><br><span class="line">    &#39;.&#x2F;src&#x2F;index.js&#39;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>polyfills.js 文件中可能只是简单的引入了一些 polyfill，例如 babel-polyfill，whatwg-fetch 等，需要在最前面被引入（我在 webpack2 时这样配置过）。</p>
<p>那什么时候是对象呢？不要捉急，后面将多页配置的时候，会说到。</p>
<h2 id="12-出口配置"><a href="#12-出口配置" class="headerlink" title="12.出口配置"></a>12.出口配置</h2><p>配置 output 选项可以控制 webpack 如何输出编译文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    entry: &#39;.&#x2F;src&#x2F;index.js&#39;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, &#39;dist&#39;), &#x2F;&#x2F;必须是绝对路径</span><br><span class="line">        filename: &#39;bundle.js&#39;,</span><br><span class="line">        publicPath: &#39;&#x2F;&#39; &#x2F;&#x2F;通常是CDN地址</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例如，你最终编译出来的代码部署在 CDN 上，资源的地址为: ‘<a href="https://AAA/BBB/YourProject/XXX&#39;，那么可以将生产的" target="_blank" rel="noopener">https://AAA/BBB/YourProject/XXX&#39;，那么可以将生产的</a> publicPath 配置为: //AAA/BBB/。</p>
<p>编译时，可以不配置，或者配置为 /。可以在我们之前提及的 config.js 中指定 publicPath（config.js 中区分了 dev 和 public）， 当然还可以区分不同的环境指定配置文件来设置，或者是根据 isDev 字段来设置。</p>
<p>除此之外呢，考虑到CDN缓存的问题，我们一般会给文件名加上 hash.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, &#39;dist&#39;), &#x2F;&#x2F;必须是绝对路径</span><br><span class="line">        filename: &#39;bundle.[hash].js&#39;,</span><br><span class="line">        publicPath: &#39;&#x2F;&#39; &#x2F;&#x2F;通常是CDN地址</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你觉得 hash 串太长的话，还可以指定长度，例如 bundle.[hash:6].js。使用 npm run build 打包看看吧。</p>
<p>问题出现啦，每次文件修改后，重新打包，导致 dist 目录下的文件越来越多。要是每次打包前，都先清空一下目录就好啦。可不可以做到呢？必须可以！</p>
<h2 id="13-每次打包前清空dist目录"><a href="#13-每次打包前清空dist目录" class="headerlink" title="13.每次打包前清空dist目录"></a>13.每次打包前清空dist目录</h2><p>反正我是懒得手动去清理的，只要你足够懒，你总是会找到好办法的，懒人推动科技进步。这里，我们需要插件: clean-webpack-plugin</p>
<p>安装依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install clean-webpack-plugin -D</span><br></pre></td></tr></table></figure>
<p>以前，clean-webpack-plugin 是默认导出的，现在不是，所以引用的时候，需要注意一下。另外，现在构造函数接受的参数是一个对象，可缺省。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">const &#123; CleanWebpackPlugin &#125; &#x3D; require(&#39;clean-webpack-plugin&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    plugins: [</span><br><span class="line">        &#x2F;&#x2F;不需要传参数喔，它可以找到 outputPath</span><br><span class="line">        new CleanWebpackPlugin() </span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在你再修改文件，重新构建，生成的hash值和之前dist中的不一样，但是因为每次 clean-webpack-plugin 都会帮我们先清空一波 dist 目录，所以不会出现太多文件，傻傻分不清楚究竟哪个是新生成文件的情况。</p>
<h3 id="希望dist目录下某个文件夹不被清空"><a href="#希望dist目录下某个文件夹不被清空" class="headerlink" title="希望dist目录下某个文件夹不被清空"></a>希望dist目录下某个文件夹不被清空</h3><p>不过呢，有些时候，我们并不希望整个 dist 目录都被清空，比如，我们不希望，每次打包的时候，都删除 dll 目录，以及 dll 目录下的文件或子目录，该怎么办呢？</p>
<p>clean-webpack-plugin 为我们提供了参数 cleanOnceBeforeBuildPatterns。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;webpack.config.js</span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">    &#x2F;&#x2F;...</span><br><span class="line">    plugins: [</span><br><span class="line">        new CleanWebpackPlugin(&#123;</span><br><span class="line">            cleanOnceBeforeBuildPatterns:[&#39;**&#x2F;*&#39;, &#39;!dll&#39;, &#39;!dll&#x2F;**&#39;] &#x2F;&#x2F;不删除dll目录下的文件</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外，clean-webpack-plugin 还有一些其它的配置，不过我使用的不多，大家可以查看clean-webpack-plugin</p>
<p>至此，我们算是完成了一个基础配置。但是这不够完美，或者说有些时候，我们还会有一些其它的需求。下一篇关于webpack配置的文章会介绍一些其它的情况。</p>

        </div>
      </article>
    </div>
    <!-- Comments -->
    <div class="container">
      
<section id="comment">
  <!-- <h1 class="title">Comments</h1> -->

  
  <div id="disqus_thread">
    <script type="text/javascript">
    var disqus_config = function () {
          this.page.url = window.location.href;
          this.page.identifier = 'post-webpack';
          this.page.title = 'webpack';
      };
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
  </div>
  
</section>


    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
        <div class="nav-previous">
          <a href="/2020/03/09/vue-webpack/" rel="prev"><span class="meta-arraw meta-arraw-left"></span> Older Posts</a>
        </div>
      
      
        <div class="nav-next">
          <a href="/2020/03/08/Human-worth/" rel="prev">Newer Posts <span class="meta-arraw meta-arraw-right"></span></a>
        </div>
      
    </div>

  </div>
</div>


  <!-- Footer -->
  <!-- Footer-widgets -->
<div class="footer-widgets">
  <div class="row inside-wrapper">
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">关于本站</h1>
        <div class="custom-widget-content">
          
          <p>张英俊的个人博客网站</p>
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">Contact</h1>
        <div class="widget-text">
          
            
              <a href="https://github.com/jean-z" class="icon icon-github" target="_blank">github</a>
            
              <a href="https://weibo.com/1780163820/profile?topnav=1&wvr=6" class="icon icon-weibo" target="_blank">weibo</a>
            
              <a href="862254760@qq.com" class="icon icon-mail" target="_blank">mail</a>
            
          
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">Search</h1>
        <div class="widget-text">
          <form onSubmit="return appDaily.submitSearch('')">
            <p>
              <input type="text" placeholder="search..." id="homeSearchInput">
            </p>
            <!-- <input type="submit" value="GO"> -->
          </form>
        </div>
      </aside>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="site-info">
  <p>
    <span>jean &copy; 2020</span>
    
      <span class="split">|</span>
      <span>Powered by <a href="">jean</a></span>
    
  </p>
</footer>


  <!-- After footer scripts -->
  <!-- scripts -->

<script src="/js/app.js"></script>


<script>
  var disqus_shortname = 'hinpc';

  
  var disqus_url = 'https://jean-z.github.io/2020/03/09/webpack/';
  

  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- baidu_analytics start -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?231ccbaa25cdcecb7c4c27e0a48b4956";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- baidu_analytics end -->




</body>

</html>
